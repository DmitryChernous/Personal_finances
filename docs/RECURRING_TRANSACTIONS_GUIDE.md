# Руководство: Регулярные платежи

## Зачем нужен этот функционал?

### Проблема, которую он решает:

Представьте ситуацию:
- У вас есть **ежемесячная аренда квартиры** (5 числа каждого месяца, 30 000 руб)
- **Подписка на Netflix** (каждый месяц, 15 числа, 500 руб)
- **Зарплата** (каждый месяц, 5 числа, 80 000 руб)
- **Страховка** (раз в год, 15 января, 10 000 руб)

**Без функционала регулярных платежей:**
- Каждый месяц вам нужно **вручную** создавать транзакцию для аренды
- Каждый месяц **вручную** создавать транзакцию для подписки
- Легко **забыть** создать транзакцию
- Приходится **помнить** все даты и суммы

**С функционалом регулярных платежей:**
- Вы **один раз** настраиваете регулярный платеж
- Система **автоматически** создает транзакции в нужные даты
- Вы **не забываете** про платежи
- Все **предсказуемо** и автоматизировано

---

## Как это работает?

### Концепция:

1. **Вы создаете "шаблон" платежа** в листе "Регулярные платежи":
   - Указываете название (например, "Аренда квартиры")
   - Указываете частоту (ежемесячно, еженедельно, и т.д.)
   - Указываете дату/день платежа
   - Указываете сумму, счет, категорию

2. **Система автоматически создает транзакции**:
   - Когда вы запускаете "Создать регулярные платежи"
   - Система проверяет все активные регулярные платежи
   - Для каждого платежа проверяет: "Нужно ли создать транзакцию сейчас?"
   - Если нужно → создает транзакцию в листе "Транзакции"
   - Запоминает дату создания в колонке "Последнее создание"

3. **Защита от дубликатов**:
   - Если транзакция уже создана для текущего периода → не создает повторно
   - Проверка идет по дате "Последнее создание"

---

## Примеры использования

### Пример 1: Ежемесячная аренда

**Настройка:**
- **Название:** "Аренда квартиры"
- **Тип:** expense (расход)
- **Частота:** monthly (ежемесячно)
- **День месяца:** 5
- **Дата начала:** 01.01.2026
- **Счет:** Карта Сбер
- **Сумма:** 30000
- **Валюта:** RUB
- **Категория:** Жильё
- **Подкатегория:** Аренда

**Как использовать:**
1. В начале каждого месяца (например, 1-5 числа) запустите: **Personal finances → Создать регулярные платежи**
2. Система проверит: "Прошло ли 5 число текущего месяца? Создана ли уже транзакция для этого месяца?"
3. Если да → создаст транзакцию с датой 05.01.2026 (или текущей датой, если 5 число уже прошло)
4. В листе "Транзакции" появится транзакция:
   - Дата: 05.01.2026
   - Тип: expense
   - Сумма: 30000
   - Категория: Жильё / Аренда

**Повторный запуск в том же месяце:**
- Система увидит, что "Последнее создание" = 05.01.2026 (в текущем месяце)
- Новая транзакция **не создастся** (защита от дубликатов)

---

### Пример 2: Еженедельная подписка

**Настройка:**
- **Название:** "Подписка на сервис"
- **Тип:** expense
- **Частота:** weekly (еженедельно)
- **День недели:** 1 (понедельник)
- **Дата начала:** 20.01.2026
- **Счет:** Карта Сбер
- **Сумма:** 500
- **Валюта:** RUB
- **Категория:** Развлечения

**Как использовать:**
1. Каждую неделю (например, в понедельник) запустите: **Personal finances → Создать регулярные платежи**
2. Система проверит: "Прошло ли >= 7 дней с последнего создания? Сегодня понедельник?"
3. Если да → создаст транзакцию с датой последнего понедельника

---

### Пример 3: Зарплата (доход)

**Настройка:**
- **Название:** "Зарплата"
- **Тип:** income (доход)
- **Частота:** monthly
- **День месяца:** 5
- **Дата начала:** 01.01.2026
- **Счет:** Карта Сбер
- **Сумма:** 80000
- **Валюта:** RUB
- **Категория:** Зарплата

**Как использовать:**
- Аналогично аренде, но тип = income
- В отчетах это будет считаться как доход

---

### Пример 4: Ежегодная страховка

**Настройка:**
- **Название:** "Страховка ОСАГО"
- **Тип:** expense
- **Частота:** yearly (ежегодно)
- **День месяца:** 15
- **Дата начала:** 15.01.2025
- **Счет:** Карта Сбер
- **Сумма:** 10000
- **Валюта:** RUB
- **Категория:** Здоровье

**Как использовать:**
1. Раз в год (например, в январе) запустите функцию
2. Система проверит: "Прошло ли >= 12 месяцев с последнего создания? Наступило ли 15 января?"
3. Если да → создаст транзакцию

---

## Частоты платежей

### Weekly (Еженедельно)
- **Когда использовать:** Подписки, которые списываются каждую неделю
- **Настройка:** Укажите **День недели** (1=понедельник, 7=воскресенье)
- **Пример:** Подписка на доставку еды каждую неделю

### Monthly (Ежемесячно)
- **Когда использовать:** Аренда, коммунальные, подписки, зарплата
- **Настройка:** Укажите **День месяца** (1-31)
- **Пример:** Аренда 5 числа, зарплата 5 числа, подписка Netflix 15 числа

### Quarterly (Ежеквартально)
- **Когда использовать:** Платежи раз в 3 месяца
- **Настройка:** Укажите **День месяца** (1-31)
- **Пример:** Квартальная оплата интернета

### Yearly (Ежегодно)
- **Когда использовать:** Страховки, годовые подписки, налоги
- **Настройка:** Укажите **День месяца** (1-31)
- **Пример:** Страховка ОСАГО, годовая подписка на сервис

---

## Важные поля

### Название
- Произвольное название для идентификации
- Используется в описании транзакции, если не указано поле "Комментарий"

### Тип
- **expense** - расход (аренда, подписки, коммунальные)
- **income** - доход (зарплата, дивиденды)
- **transfer** - перевод между счетами

### Частота
- Определяет, как часто создавать транзакции
- Влияет на обязательность полей:
  - **weekly** → обязателен **День недели**
  - **monthly/quarterly/yearly** → обязателен **День месяца**

### День месяца (DayOfMonth)
- Число от 1 до 31
- Для месяцев с меньшим количеством дней (например, февраль = 28/29 дней):
  - Если указано 31, а в месяце 30 дней → используется 30 число
  - Если указано 31, а в месяце 28 дней → используется 28 число

### День недели (DayOfWeek)
- 1 = Понедельник
- 2 = Вторник
- 3 = Среда
- 4 = Четверг
- 5 = Пятница
- 6 = Суббота
- 7 = Воскресенье

### Дата начала (StartDate)
- С какой даты начинать создавать транзакции
- Если указана дата в будущем → транзакции не будут создаваться до этой даты

### Дата окончания (EndDate)
- До какой даты создавать транзакции
- Если указана → после этой даты транзакции не будут создаваться
- Если пусто → создавать бесконечно

### Активно
- **true** или пусто → платеж активен, транзакции создаются
- **false** → платеж неактивен, транзакции не создаются
- Полезно для временного отключения платежа без удаления

### Последнее создание (LastCreated)
- Автоматически заполняется системой
- Содержит дату последней созданной транзакции
- Используется для защиты от дубликатов
- Можно очистить вручную, если нужно создать транзакцию заново

---

## Типичный сценарий использования

### Начало работы:

1. **Запустите Setup:**
   - Personal finances → Setup (создать листы)
   - Убедитесь, что создался лист "Регулярные платежи"

2. **Добавьте регулярные платежи:**
   - Откройте лист "Регулярные платежи"
   - Добавьте все ваши регулярные платежи:
     - Аренда
     - Коммунальные
     - Подписки
     - Зарплата
     - И т.д.

3. **Проверьте настройки:**
   - Убедитесь, что все поля заполнены правильно
   - Проверьте, что "Активно" = true или пусто

### Ежедневное/еженедельное использование:

1. **В начале месяца (или раз в неделю):**
   - Запустите: **Personal finances → Создать регулярные платежи**

2. **Проверьте результат:**
   - Откройте лист "Транзакции"
   - Убедитесь, что транзакции созданы
   - Проверьте суммы и категории

3. **Если нужно создать транзакции за прошлый период:**
   - Можно временно изменить "Дата начала" на прошлую дату
   - Или очистить "Последнее создание"
   - Запустить функцию снова

---

## FAQ

### Вопрос: Нужно ли запускать функцию каждый день?

**Ответ:** Нет, достаточно запускать:
- **Для monthly платежей:** раз в месяц (в начале месяца)
- **Для weekly платежей:** раз в неделю
- **Для yearly платежей:** раз в год

### Вопрос: Что если я забыл запустить функцию в нужную дату?

**Ответ:** Ничего страшного! Просто запустите функцию позже:
- Система создаст транзакцию с правильной датой (день месяца или день недели)
- Например, если аренда должна быть 5 числа, а вы запустили 10 числа → транзакция создастся с датой 05.01.2026

### Вопрос: Можно ли создать транзакции за прошлые месяцы?

**Ответ:** Да, но нужно:
1. Очистить колонку "Последнее создание" для нужного платежа
2. Или временно изменить "Дата начала" на прошлую дату
3. Запустить функцию

### Вопрос: Что если я хочу временно отключить платеж?

**Ответ:** Установите **"Активно" = false**. Транзакции не будут создаваться, но настройки сохранятся.

### Вопрос: Можно ли изменить сумму платежа?

**Ответ:** Да, просто измените значение в колонке "Сумма". Следующая созданная транзакция будет с новой суммой.

### Вопрос: Что делать, если платеж закончился?

**Ответ:** 
- Установите **"Дата окончания"** на дату окончания
- Или установите **"Активно" = false**
- Или просто удалите строку

---

## Преимущества использования

✅ **Экономия времени:** Не нужно каждый месяц вручную создавать одни и те же транзакции

✅ **Не забываете платежи:** Система напомнит создать транзакции

✅ **Точность:** Все транзакции создаются с правильными датами, суммами, категориями

✅ **Планирование:** Видите все регулярные платежи в одном месте

✅ **Автоматизация:** Минимум ручной работы

---

## Ограничения

⚠️ **Не полностью автоматично:** Нужно вручную запускать функцию "Создать регулярные платежи"

⚠️ **Не создает транзакции в будущем:** Создает только для текущего/прошлого периода

⚠️ **Не интегрируется с банками:** Это не автоматическое списание, а создание записей в вашей таблице

---

## Сравнение с реальными платежами

**Важно понимать:**
- Этот функционал **не списывает деньги** с вашего счета
- Он только **создает записи** в таблице для учета
- Реальные платежи (списание с карты) происходят отдельно (через банк, подписки и т.д.)
- Этот функционал помогает **не забыть учесть** эти платежи в вашей системе учета

**Пример:**
- У вас есть подписка Netflix, которая **автоматически списывается** с карты каждый месяц
- Этот функционал помогает **автоматически создать запись** об этом списании в вашей таблице
- Так вы не забываете учесть этот расход в аналитике

---

## Итог

**Регулярные платежи** = способ автоматизировать создание повторяющихся транзакций, чтобы:
- Не делать это вручную каждый раз
- Не забывать про платежи
- Иметь полную картину всех регулярных расходов/доходов

Это как "напоминание + автозаполнение" для ваших финансов.

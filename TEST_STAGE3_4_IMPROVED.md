# Тестирование улучшенных Этапов 3-4

Дата: 2026-01-24

## Подготовка

1. Откройте Google Таблицу и обновите страницу (F5)
2. Запустите **Personal finances → Setup (создать листы)**
3. Сгенерируйте тестовые данные: **Personal finances → Заполнить тестовыми данными**
   - Выберите "Да" для очистки существующих данных (если нужно)

## Тест 1: Проверка листа "Отчеты" — базовые секции

- [ ] Лист `Отчеты` создан
- [ ] Проверьте наличие секций:
  - "Сводка по периодам" (доходы/расходы за месяц и год)
  - "Топ расходов по категориям" (таблица с категориями и суммами)
  - "Денежный поток по месяцам" (последние 12 месяцев) — **НОВОЕ**
  - "Остатки по счетам" (с учетом начального баланса и переводов) — **УЛУЧШЕНО**

## Тест 2: Сводка по периодам

- [ ] В секции "Сводка по периодам" проверьте:
  - Строка "Текущий месяц": доходы, расходы, итого
  - Строка "Текущий год": доходы, расходы, итого
  - Формулы автоматически пересчитываются при изменении транзакций
  - Числа отображаются в формате `#,##0.00`

## Тест 3: Топ расходов по категориям (скриптовый расчет)

- [ ] В секции "Топ расходов по категориям":
  - Есть таблица с колонками "Категория" и "Сумма"
  - Категории отсортированы по убыванию суммы
  - Не более 10 категорий
  - Показываются только расходы за текущий месяц со статусом "ok"
- [ ] Добавьте новую транзакцию-расход с категорией
- [ ] Запустите **Personal finances → Обновить отчёты**
- [ ] Проверьте, что топ категорий обновился (данные пересчитались скриптом)

## Тест 4: Денежный поток по месяцам (НОВОЕ — скриптовый расчет)

- [ ] В секции "Денежный поток по месяцам":
  - Есть таблица с колонками: "Месяц", "Доходы", "Расходы", "Итого"
  - Показаны последние 12 месяцев (включая текущий)
  - Для каждого месяца есть данные (доходы, расходы, итого)
  - Месяцы отсортированы от старых к новым
  - Числа отображаются в формате `#,##0.00`
- [ ] Добавьте транзакции за разные месяцы
- [ ] Запустите **Personal finances → Обновить отчёты**
- [ ] Проверьте, что данные по месяцам обновились

## Тест 5: Остатки по счетам (УЛУЧШЕНО — начальный баланс + переводы)

- [ ] В листе `Счета` проверьте, что у счетов заполнен "Начальный баланс"
- [ ] В секции "Остатки по счетам":
  - Для каждого счёта показан остаток
  - Остаток = Начальный баланс + Доходы - Расходы - Переводы исходящие + Переводы входящие
- [ ] Проверьте расчет вручную:
  - Возьмите один счёт
  - Посчитайте: начальный баланс + все доходы - все расходы - переводы от этого счёта + переводы на этот счёт
  - Сравните с остатком в отчете
- [ ] Добавьте перевод между счетами:
  - Создайте транзакцию с `Type = transfer`
  - Укажите счет-источник и счет-получатель
  - Запустите **Personal finances → Обновить отчёты**
  - Проверьте, что остатки обновились:
    - У счета-источника остаток уменьшился
    - У счета-получателя остаток увеличился

## Тест 6: Лист "Дашборд"

- [ ] Лист `Дашборд` создан
- [ ] Проверьте KPI карточки:
  - "Доходы" (текущий месяц)
  - "Расходы" (текущий месяц)
  - "Итого" (доходы - расходы)
  - "Средний расход в день"
  - Все числа в формате `#,##0.00`
- [ ] Проверьте график "Расходы по категориям":
  - Есть pie chart (круговая диаграмма)
  - График показывает топ категорий расходов за текущий месяц
  - Данные для графика генерируются скриптом (не формулой)
- [ ] Добавьте новую транзакцию-расход
- [ ] Запустите **Personal finances → Обновить дашборд**
- [ ] Проверьте, что KPI и график обновились

## Тест 7: Обновление скриптовых данных

- [ ] Добавьте несколько новых транзакций в `Транзакции`
- [ ] Запустите **Personal finances → Обновить отчёты**
- [ ] Проверьте, что обновились:
  - Топ категорий (скриптовый расчет)
  - Месячный cashflow (скриптовый расчет)
  - Остатки по счетам (формулы обновляются автоматически)
- [ ] Запустите **Personal finances → Обновить дашборд**
- [ ] Проверьте, что обновились:
  - KPI (формулы обновляются автоматически)
  - График категорий (скриптовый расчет)

## Тест 8: Проверка улучшений

### Улучшение 1: Начальный баланс в остатках
- [ ] В листе `Счета` измените "Начальный баланс" для одного счёта
- [ ] Запустите **Personal finances → Обновить отчёты**
- [ ] Проверьте, что остаток в отчете изменился с учетом нового начального баланса

### Улучшение 2: Переводы в остатках
- [ ] Создайте перевод: `Type = transfer`, `Account = Карта Сбер`, `AccountTo = Вклад`, `Amount = 5000`
- [ ] Запустите **Personal finances → Обновить отчёты**
- [ ] Проверьте остатки:
  - "Карта Сбер": остаток уменьшился на 5000
  - "Вклад": остаток увеличился на 5000

### Улучшение 3: Месячный cashflow
- [ ] Проверьте, что в секции "Денежный поток по месяцам" есть данные за последние 12 месяцев
- [ ] Убедитесь, что для каждого месяца правильно считаются доходы и расходы
- [ ] Проверьте, что переводы (`transfer`) не учитываются в cashflow (только доходы и расходы)

## Известные особенности

- ✅ Месячный cashflow реализован (последние 12 месяцев)
- ✅ Остатки по счетам учитывают начальный баланс из листа `Счета`
- ✅ Остатки по счетам учитывают переводы (`transfer`)
- ⚠️ Скриптовые расчеты (топ категорий, cashflow) обновляются только при вызове "Обновить отчёты" / "Обновить дашборд" (не автоматически)
- ⚠️ Формулы могут быть медленными при большом количестве транзакций (1000+)

## Результаты тестирования

- [ ] Все тесты пройдены успешно
- [ ] Найдены проблемы (опишите ниже):

---

**Примечание**: Если что-то не работает, опишите проблему подробно, включая:
- Какой тест не прошел
- Что ожидалось
- Что получилось
- Скриншот (если возможно)

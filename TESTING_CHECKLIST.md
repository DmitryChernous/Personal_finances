# Чек-лист тестирования (Этап 2)

Дата: 2026-01-24

## Подготовка

1. Откройте Google Таблицу, связанную с проектом (через `npm run open` или напрямую).
2. Обновите страницу, чтобы загрузился новый код Apps Script.
3. Если меню не появилось автоматически, обновите страницу ещё раз или перезапустите `onOpen()` через редактор Apps Script.

## Тест 1: Setup и базовая структура

- [ ] Запустите **Personal finances → Setup (создать листы)**
- [ ] Проверьте, что созданы все листы: `Транзакции`, `Категории`, `Счета`, `Настройки`, `Инструкция`, `Отчеты`, `Дашборд`
- [ ] Проверьте, что в листе `Транзакции` есть шапка с колонками (Дата, Тип, Счет, и т.д.)
- [ ] Проверьте, что первая строка заморожена (frozen row)
- [ ] Проверьте, что есть автофильтр на шапке

## Тест 2: Справочники (Accounts и Categories)

- [ ] В листе `Счета` добавьте несколько счетов (например: "Наличные", "Карта Сбер", "Вклад")
- [ ] В листе `Категории` добавьте несколько категорий (например: "Еда", "Транспорт", "Зарплата")
- [ ] Проверьте, что в листе `Транзакции` в колонке `Счет` появляется выпадающий список с вашими счетами
- [ ] Проверьте, что в колонке `Категория` появляется выпадающий список с вашими категориями

## Тест 3: Валидации и выпадающие списки

- [ ] В листе `Транзакции` добавьте новую строку (строка 2)
- [ ] Проверьте, что в колонке `Тип` есть выпадающий список: `expense`, `income`, `transfer`
- [ ] Проверьте, что в колонке `Статус` есть выпадающий список: `ok`, `needs_review`, `duplicate`, `deleted`
- [ ] Проверьте, что в колонке `Валюта` есть выпадающий список: `RUB`, `USD`, `EUR`
- [ ] Попробуйте ввести недопустимое значение в `Тип` — должно быть отклонено
- [ ] Попробуйте ввести отрицательное число или 0 в `Сумма` — должно быть отклонено

## Тест 4: Автозаполнение при редактировании (onEdit)

- [ ] Добавьте новую строку с данными:
  - Дата: `01.01.2026`
  - Тип: `expense`
  - Счет: выберите из списка
  - Сумма: `1000`
  - Оставьте `Источник`, `Статус`, `Валюта` пустыми
- [ ] Перейдите в другую ячейку (чтобы сработал `onEdit`)
- [ ] Проверьте, что автоматически заполнились:
  - `Источник` = `manual`
  - `Статус` = `ok`
  - `Валюта` = `RUB` (или значение из настроек)
- [ ] Попробуйте ввести текст с пробелами в начале/конце в колонке `Комментарий` — должен автоматически обрезаться (trim)

## Тест 5: Валидация обязательных полей

- [ ] Создайте строку без `Даты` — должна подсветиться красным
- [ ] Создайте строку без `Типа` — должна подсветиться красным
- [ ] Создайте строку без `Счета` — должна подсветиться красным
- [ ] Создайте строку без `Суммы` — должна подсветиться красным
- [ ] Создайте строку с `Тип = transfer` без `Счет (получатель)` — должна подсветиться красным
- [ ] Создайте строку с `Тип = transfer` с заполненной `Категорией` — должна подсветиться красным (перевод не должен иметь категорию)

## Тест 6: Меню "Проверить все транзакции"

- [ ] Добавьте несколько строк с ошибками (незаполненные обязательные поля)
- [ ] Запустите **Personal finances → Проверить все транзакции**
- [ ] Проверьте, что появилось сообщение с количеством ошибок
- [ ] Проверьте, что строки с ошибками подсвечены красным цветом
- [ ] Исправьте ошибки и запустите проверку снова — должно быть сообщение "Все строки валидны"

## Тест 7: Меню "Пометить на проверку"

- [ ] Выберите одну или несколько строк в листе `Транзакции` (не заголовок!)
- [ ] Запустите **Personal finances → Пометить на проверку**
- [ ] Проверьте, что в колонке `Статус` выбранных строк установлено значение `needs_review`
- [ ] Попробуйте выбрать только заголовок — должно появиться предупреждение

## Тест 8: Повторный запуск Setup (идемпотентность)

- [ ] Заполните несколько строк в `Транзакции` с данными
- [ ] Запустите **Personal finances → Setup (создать листы)** ещё раз
- [ ] Проверьте, что данные не удалились
- [ ] Проверьте, что шапки не дублируются
- [ ] Проверьте, что валидации и форматы остались на месте

## Тест 9: Переключение языка

- [ ] Запустите **Personal finances → Язык → English**
- [ ] Проверьте, что имена листов изменились на английские (`Transactions`, `Categories`, и т.д.)
- [ ] Проверьте, что заголовки колонок изменились на английские
- [ ] Проверьте, что меню изменилось на английское
- [ ] Переключите обратно на русский — всё должно вернуться

## Известные ограничения / возможные проблемы

- `onEdit()` может быть медленным на больших таблицах (1000+ строк)
- Подсветка ошибок может не обновляться мгновенно при очень быстром редактировании
- Если таблица очень большая, массовая валидация может занять время

## Что сообщить, если что-то не работает

1. Какая именно функция не работает
2. Какое сообщение об ошибке (если есть)
3. На каком шаге тестирования возникла проблема
4. Скриншот (если возможно)

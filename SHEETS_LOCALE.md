# Локаль Google Sheets и синтаксис формул (важно)

Этот проект рассчитан на **русскоязычные Google Sheets**. Это влияет на то, как парсятся формулы и как отображаются числа/даты.

## Базовая договорённость проекта

- **Spreadsheet locale**: `ru_RU` (Россия)
- **Часовой пояс**: `Europe/Moscow` (уже задан в `src/appsscript.json`)

Эта договорённость должна соблюдаться во всех новых частях проекта (скрипты, листы `Reports/Dashboard`, инструкции на листе `Help`).

## Что это значит на практике

- **Разделитель аргументов функций** в формулах: обычно `;` (а не `,`)
- **Десятичный разделитель**: обычно `,` (а не `.`)
- **Форматы дат/валюты**: зависят от локали и должны быть совместимы с `ru_RU`

## Как избегаем ошибок в Apps Script

1) **Всегда используем `;` как разделитель аргументов** в формулах, которые задаются программно (`setFormula`, `setFormulas`, значения начинающиеся с `=` и т.п.).  
Это уменьшает риск `#ERROR` при отличающихся локалях.  
Примечание: для **литералов массивов** (`{...}`) есть особенности локали — в проекте стараемся **избегать** таких формул или обрабатывать их отдельно.

2) **В `pfSetup()` (этап 1) закрепляем локаль таблицы** через Apps Script:
- `SpreadsheetApp.getActiveSpreadsheet().setSpreadsheetLocale('ru_RU')`

3) **По возможности не “зашиваем” числа с десятичной частью прямо в формулы**, а используем ссылки на ячейки/значения + `setNumberFormat()`.

## Заметка про язык названий функций

В Google Sheets есть настройка (Файл → Настройки) “Always use English function names”.  
В зависимости от неё пользователь может видеть функции на русском (например `СУММ`) или на английском (`SUM`).  
Для совместимости проект стремится:
- в коде/скриптах — использовать формулы, которые корректно парсятся при `ru_RU` (в первую очередь разделитель `;`)
- в пользовательских инструкциях — давать примеры, понятные русскоязычному интерфейсу

